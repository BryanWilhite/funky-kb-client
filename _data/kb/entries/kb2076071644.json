{
  "Document": {
    "DocumentId": 2076071644,
    "Title": "Word 2003 VBA Code: Emergency Repair Routines for Schema Violations; RepairAttributeViolations()",
    "DocumentShortName": null,
    "FileName": null,
    "Path": null,
    "CreateDate": "2005-02-12T01:21:57.833",
    "ModificationDate": "2005-02-12T01:21:57.833",
    "TemplateId": null,
    "SegmentId": 76,
    "IsRoot": false,
    "IsActive": true,
    "SortOrdinal": null,
    "ClientId": null,
    "Tag": null
  },
  "Content": "Public Sub RepairAttributeViolations(ByVal NodeBaseName As String, _\n    BadAttrBaseName As String, NewAttrBaseName As String)\n    '\n    'Fixes attribute-level schema violation problem\n    'when schema files are updated or replaced.\n    '\n    Dim nodes As Word.XMLNodes, node As Word.XMLNode, attr As Word.XMLNode\n    Dim newAttr As Word.XMLNode\n    \n    Dim strXPath As String, strAlias As String\n    \n    strAlias = \"xmlns:x='\" & XHTML_NAMESPACE_URI & \"'\"\n    strXPath = \"//x:\" & NodeBaseName\n    \n    Set nodes = ActiveDocument.SelectNodes(strXPath, strAlias)\n\n    For Each node In nodes\n        For Each attr In node.Attributes\n            Select Case attr.BaseName\n                Case BadAttrBaseName\n                    Set newAttr = _\n                        node.Attributes.Add(NewAttrBaseName, vbNullString)\n                    \n                    newAttr.NodeValue = attr.NodeValue\n                    Call attr.Delete\n            \n            End Select\n        Next\n    Next\nEnd Sub\n\nSub tmp()\n    '\n    'Copy the correct img element attributes from oldDoc to newDoc.\n    '\n    Dim oldDoc As Word.Document\n    Dim newDoc As Word.Document\n    \n    Dim oldNodes As Word.XMLNodes, newNodes As Word.XMLNodes\n    Dim node As Word.XMLNode, newNode As Word.XMLNode\n    Dim attr As Word.XMLNode, newAttr As Word.XMLNode, i As Long\n    \n    Dim strXPath As String, strAlias As String\n    \n    strAlias = \"xmlns:x='\" & XHTML_NAMESPACE_URI & \"'\"\n    strXPath = \"//x:img\"\n    \n    Set oldDoc = Application.Documents(1)\n    Set newDoc = Application.Documents(2)\n\n    Set oldNodes = oldDoc.SelectNodes(strXPath, strAlias)\n    Set newNodes = newDoc.SelectNodes(strXPath, strAlias)\n\n    For i = 1 To oldNodes.Count\n        For Each attr In oldNodes(i).Attributes\n            Select Case attr.BaseName\n                Case \"alt\"\n                    Set newNode = newNodes(i)\n                    Set newAttr = _\n                        newNode.Attributes.Add(\"alt\", vbNullString)\n                    newAttr.NodeValue = attr.NodeValue\n            \n                Case \"height\"\n                    Set newNode = newNodes(i)\n                    Set newAttr = _\n                        newNode.Attributes.Add(\"height\", vbNullString)\n                    newAttr.NodeValue = attr.NodeValue\n            \n                Case \"src\"\n                    Set newNode = newNodes(i)\n                    Set newAttr = _\n                        newNode.Attributes.Add(\"src\", vbNullString)\n                    newAttr.NodeValue = attr.NodeValue\n            \n                Case \"style\"\n                    Set newNode = newNodes(i)\n                    Set newAttr = _\n                        newNode.Attributes.Add(\"style\", vbNullString)\n                    newAttr.NodeValue = attr.NodeValue\n            \n                Case \"width\"\n                    Set newNode = newNodes(i)\n                    Set newAttr = _\n                        newNode.Attributes.Add(\"width\", vbNullString)\n                    newAttr.NodeValue = attr.NodeValue\n            End Select\n        Next\n    Next\nEnd Sub\n\nPrivate Sub tmp2()\n    '\n    'Delete incorrect attributes from img elements.\n    '\n    Dim nodes As Word.XMLNodes, node As Word.XMLNode, attr As Word.XMLNode\n    Dim newAttr As Word.XMLNode\n    \n    Dim strXPath As String, strAlias As String\n    \n    strAlias = \"xmlns:x='\" & XHTML_NAMESPACE_URI & \"'\"\n    strXPath = \"//x:img\"\n    \n    Set nodes = ActiveDocument.SelectNodes(strXPath, strAlias)\n\n    For Each node In nodes\n        For Each attr In node.Attributes\n            Select Case attr.BaseName\n                Case \"shape\"\n                    Call attr.Delete\n            End Select\n        Next\n    Next\nEnd Sub\n",
  "Tag": "kb2076071644"
}