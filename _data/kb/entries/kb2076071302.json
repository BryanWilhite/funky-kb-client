{
  "Document": {
    "DocumentId": 2076071302,
    "Title": "T-SQL Code: A Procedure Using CASE Structures to Format Times",
    "DocumentShortName": null,
    "FileName": null,
    "Path": null,
    "CreateDate": "2000-12-24T14:50:05.653",
    "ModificationDate": "2000-12-24T14:50:05.653",
    "TemplateId": null,
    "SegmentId": 72,
    "IsRoot": false,
    "IsActive": true,
    "SortOrdinal": null,
    "ClientId": null,
    "Tag": null
  },
  "Content": "CREATE Procedure ListGo2Events\n\nAS\n\nSET NOCOUNT ON\n\n-- Collect data into temp' table.\nSELECT\n    tblVenueEvents.EventID\n,    tblVenueEvents.ArtistSummary\n,    tblVenueEvents.ArtistExtended\n,    tblVenueEvents.VenueID\n,    tblVenueEvents.DoorDate\n,    tblVenueEvents.DoorTime\n,    tblVenueEvents.EventDate\n,    tblVenueEvents.EventTime\n,    tblVenueEvents.GenreID\n,    sch_t_genre.genre_name\n,    tblVenueEvents.AgeRestriction\n,    tblVenueEvents.SoldOutIndicator\n,    tblVenueEvents.ChangedToDate\n,    tblVenueEvents.ChangedToTime\n,    tblVenueEvents.Canceled\nINTO\n    #out\nFROM\n    tblVenueEvents\n,    sch_t_genre\nWHERE\n    tblVenueEvents.GenreID = sch_t_genre.genre_id\nAND\n    MONTH(tblVenueEvents.EventDate) >= MONTH(GETDATE())\nAND\n    DAY(tblVenueEvents.EventDate) >= DAY(GETDATE())\nAND\n    YEAR(tblVenueEvents.EventDate) >= YEAR(GETDATE())\n\n-- Attempt to format Event times...\n\n-- First sweep...\nUPDATE #out\nSET\n    DoorTime = (\n        CASE\n            WHEN DoorTime LIKE '%[^1-9]1:__%' THEN '13' +\nSUBSTRING(DoorTime,CHARINDEX(\":\",DoorTime) + 1,2)\n            WHEN DoorTime LIKE '%[^1-9]2:__%' THEN '14' +\nSUBSTRING(DoorTime,CHARINDEX(\":\",DoorTime) + 1,2)\n            WHEN DoorTime LIKE '%[^1-9]3:__%' THEN '15' +\nSUBSTRING(DoorTime,CHARINDEX(\":\",DoorTime) + 1,2)\n            WHEN DoorTime LIKE '%[^1-9]4:__%' THEN '16' +\nSUBSTRING(DoorTime,CHARINDEX(\":\",DoorTime) + 1,2)\n            WHEN DoorTime LIKE '%[^1-9]5:__%' THEN '17' +\nSUBSTRING(DoorTime,CHARINDEX(\":\",DoorTime) + 1,2)\n            WHEN DoorTime LIKE '%[^1-9]6:__%' THEN '18' +\nSUBSTRING(DoorTime,CHARINDEX(\":\",DoorTime) + 1,2)\n            WHEN DoorTime LIKE '%[^1-9]7:__%' THEN '19' +\nSUBSTRING(DoorTime,CHARINDEX(\":\",DoorTime) + 1,2)\n            WHEN DoorTime LIKE '%[^1-9]8:__%' THEN '20' +\nSUBSTRING(DoorTime,CHARINDEX(\":\",DoorTime) + 1,2)\n            WHEN DoorTime LIKE '%[^1-9]9:__%' THEN '21' +\nSUBSTRING(DoorTime,CHARINDEX(\":\",DoorTime) + 1,2)\n            WHEN DoorTime LIKE '%[^1-9]10:__%' THEN '22' +\nSUBSTRING(DoorTime,CHARINDEX(\":\",DoorTime) + 1,2)\n            WHEN DoorTime LIKE '%[^1-9]11:__%' THEN '23' +\nSUBSTRING(DoorTime,CHARINDEX(\":\",DoorTime) + 1,2)\n        END\n    )\nWHERE\n    CHARINDEX(':',DoorTime) > 0\n\nUPDATE #out\nSET\n    EventTime = (\n        CASE\n            WHEN EventTime LIKE '%[^1-9]1:__%' THEN '13' +\nSUBSTRING(EventTime,CHARINDEX(\":\",EventTime) + 1,2)\n            WHEN EventTime LIKE '%[^1-9]2:__%' THEN '14' +\nSUBSTRING(EventTime,CHARINDEX(\":\",EventTime) + 1,2)\n            WHEN EventTime LIKE '%[^1-9]3:__%' THEN '15' +\nSUBSTRING(EventTime,CHARINDEX(\":\",EventTime) + 1,2)\n            WHEN EventTime LIKE '%[^1-9]4:__%' THEN '16' +\nSUBSTRING(EventTime,CHARINDEX(\":\",EventTime) + 1,2)\n            WHEN EventTime LIKE '%[^1-9]5:__%' THEN '17' +\nSUBSTRING(EventTime,CHARINDEX(\":\",EventTime) + 1,2)\n            WHEN EventTime LIKE '%[^1-9]6:__%' THEN '18' +\nSUBSTRING(EventTime,CHARINDEX(\":\",EventTime) + 1,2)\n            WHEN EventTime LIKE '%[^1-9]7:__%' THEN '19' +\nSUBSTRING(EventTime,CHARINDEX(\":\",EventTime) + 1,2)\n            WHEN EventTime LIKE '%[^1-9]8:__%' THEN '20' +\nSUBSTRING(EventTime,CHARINDEX(\":\",EventTime) + 1,2)\n            WHEN EventTime LIKE '%[^1-9]9:__%' THEN '21' +\nSUBSTRING(EventTime,CHARINDEX(\":\",EventTime) + 1,2)\n            WHEN EventTime LIKE '%[^1-9]10:__%' THEN '22' +\nSUBSTRING(EventTime,CHARINDEX(\":\",EventTime) + 1,2)\n            WHEN EventTime LIKE '%[^1-9]11:__%' THEN '23' +\nSUBSTRING(EventTime,CHARINDEX(\":\",EventTime) + 1,2)\n        END\n    )\nWHERE\n    CHARINDEX(':',EventTime) > 0\n\nUPDATE #out\nSET\n    ChangedToTime = (\n        CASE\n            WHEN ChangedToTime LIKE '%[^1-9]1:__%' THEN '13' +\nSUBSTRING(ChangedToTime,CHARINDEX(\":\",ChangedToTime) + 1,2)\n            WHEN ChangedToTime LIKE '%[^1-9]2:__%' THEN '14' +\nSUBSTRING(ChangedToTime,CHARINDEX(\":\",ChangedToTime) + 1,2)\n            WHEN ChangedToTime LIKE '%[^1-9]3:__%' THEN '15' +\nSUBSTRING(ChangedToTime,CHARINDEX(\":\",ChangedToTime) + 1,2)\n            WHEN ChangedToTime LIKE '%[^1-9]4:__%' THEN '16' +\nSUBSTRING(ChangedToTime,CHARINDEX(\":\",ChangedToTime) + 1,2)\n            WHEN ChangedToTime LIKE '%[^1-9]5:__%' THEN '17' +\nSUBSTRING(ChangedToTime,CHARINDEX(\":\",ChangedToTime) + 1,2)\n            WHEN ChangedToTime LIKE '%[^1-9]6:__%' THEN '18' +\nSUBSTRING(ChangedToTime,CHARINDEX(\":\",ChangedToTime) + 1,2)\n            WHEN ChangedToTime LIKE '%[^1-9]7:__%' THEN '19' +\nSUBSTRING(ChangedToTime,CHARINDEX(\":\",ChangedToTime) + 1,2)\n            WHEN ChangedToTime LIKE '%[^1-9]8:__%' THEN '20' +\nSUBSTRING(ChangedToTime,CHARINDEX(\":\",ChangedToTime) + 1,2)\n            WHEN ChangedToTime LIKE '%[^1-9]9:__%' THEN '21' +\nSUBSTRING(ChangedToTime,CHARINDEX(\":\",ChangedToTime) + 1,2)\n            WHEN ChangedToTime LIKE '%[^1-9]10:__%' THEN '22' +\nSUBSTRING(ChangedToTime,CHARINDEX(\":\",ChangedToTime) + 1,2)\n            WHEN ChangedToTime LIKE '%[^1-9]11:__%' THEN '23' +\nSUBSTRING(ChangedToTime,CHARINDEX(\":\",ChangedToTime) + 1,2)\n        END\n    )\nWHERE\n    CHARINDEX(':',ChangedToTime) > 0\n\n-- Second sweep...\nUPDATE #out\nSET\n    DoorTime = RTRIM(DoorTime) + '00'\nWHERE\n    LEN(DoorTime) = 2\n\nUPDATE #out\nSET\n    EventTime = RTRIM(EventTime) + '00'\nWHERE\n    LEN(EventTime) = 2\n\nUPDATE #out\nSET\n    ChangedToTime = RTRIM(ChangedToTime) + '00'\nWHERE\n    LEN(ChangedToTime) = 2\n\n-- Project result.\nSELECT\n    EventID\n,    ArtistSummary\n,    ArtistExtended\n,    VenueID\n,    DoorDate\n,    DoorTime\n,    EventDate\n,    EventTime\n,    GenreID\n,    genre_name\n,    AgeRestriction\n,    SoldOutIndicator\n,    ChangedToDate\n,    ChangedToTime\n,    Canceled\nFROM\n    #out\n\n",
  "Tag": "kb2076071302"
}