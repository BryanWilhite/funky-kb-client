{
  "Document": {
    "DocumentId": 745182366,
    "Title": "VB Code: General Structure for an IIS Application",
    "DocumentShortName": null,
    "FileName": null,
    "Path": null,
    "CreateDate": "2000-04-11T22:55:17",
    "ModificationDate": "2000-04-11T22:55:17",
    "TemplateId": null,
    "SegmentId": 77,
    "IsRoot": false,
    "IsActive": true,
    "SortOrdinal": null,
    "ClientId": null,
    "Tag": null
  },
  "Content": "'Since I am very untrusting of VB 6 Web Classes,\n'I start IIS Applications with an ActiveX DLL Project.\n'I have one Class (called WebApp) \n'that talks directly to the server\n'and the other Classes support the WebApp Class.\n'This is the code that builds WebApp:\n'\n'For more details about this technique please see\n'MS KB article Q238274\n'(\"Q238274 - HOWTO: Obtain ObjectContext with\n'ObjectControl Inside VB COM DLL From ASP and MTS\")\n'\n'and\n'\n'MSDN Article \"Instancing for Classes Provided by ActiveX Components\"\n'(http://msdn.microsoft.com/library/devprods/vs6/vbasic\n'/vbcon98/vbconinstancingforolecomponentclasses.htm)\n'\nImplements ObjectControl\n\nPrivate MTSObjectContext As MTxAS.ObjectContext\nPrivate ASPApplication As ASPTypeLibrary.Application\nPrivate ASPRequest As ASPTypeLibrary.Request\nPrivate ASPResponse As ASPTypeLibrary.Response\nPrivate ASPServer As ASPTypeLibrary.Server\nPrivate ASPSession As ASPTypeLibrary.Session\n\nPrivate p_strHTML As String\nPrivate p_ADOrst As ADODB.Recordset\n\n'These statements refer to the Classes that\n'support\" the WebApp Class:Public objHTML As HTMLServices\nPublic objADO  As ADOServices\nPublic objExcel As ExcelServices\nPublic objStr  As StringServices\nPublic objTextFile As TextFileHandler\n\nPrivate Sub ObjectControl_Activate()\n    'The MTSObjectContext object variable is access to MTS.\n    Set MTSObjectContext = MTxAS.GetObjectContext()\n    Set ASPApplication = MTSObjectContext.Item(\"Application\")\n    Set ASPRequest = MTSObjectContext.Item(\"Request\")\n    Set ASPResponse = MTSObjectContext.Item(\"Response\")\n    Set ASPServer = MTSObjectContext.Item(\"Server\")\n    \n    'TIP: Avoid using the Session object for Stateless\n    'high performance.\n    'The @EnableSessionState Directive is set to False.\n    'If a Session is needed then uncomment this line:\n    'Set ASPSession = MTSObjectContext.Item(\"Session\")\n    \n    Set objHTML = _\n        MTSObjectContext.CreateInstance(VB.App.EXEName _\n            & \".HTMLServices\")\n    'Note that we are using CreateInstance.\n    'To use VBA object-creation methods would instantiate \n    'these objects outside of MTS context.\n    \nEnd Sub\n\nPrivate Sub ObjectControl_Deactivate()\n    \n    Set ASPApplication = Nothing\n    Set ASPRequest = Nothing\n    Set ASPResponse = Nothing\n    Set ASPServer = Nothing\n    Set ASPSession = Nothing\n    \n    Set objHTML = Nothing\n    \n    Set MTSObjectContext = Nothing\n\nEnd Sub\n\nPrivate Function ObjectControl_CanBePooled() As Boolean\n    ObjectControl_CanBePooled = False\nEnd Function\n\nPublic Sub Command(Optional ByVal Cmd = vbNullString)\n\n    If ASPRequest.QueryString.Count > 0 Then\n        Cmd = ASPRequest.QueryString.Item(\"Cmd\")\n    End If\n    \n    Select Case Cmd\n        Case \"SayHello\"\n            Call ASPResponse.Write(objHTML.GetPage(\"Hello World!\"))\n        Case Else\n            p_strHTML = \"<H1>IIS Web Application</H1>\" & vbCrLf _\n                & \"<UL>\" & vbCrLf _\n                & VBA.Space$(4) & \"<LI>Application Name: \" _\n                & App.ProductName & \"</LI>\" & vbCrLf _\n                & VBA.Space$(4) & \"<LI>Copyright: \" _\n                & VB.App.LegalCopyright & \"</LI>\" & vbCrLf _\n                & VBA.Space$(4) & \"<LI>Company Name: \" _\n                & VB.App.CompanyName & \"</LI>\" & vbCrLf _\n                & VBA.Space$(4) & \"<LI>Comments: \" _\n                & VB.App.Comments & \"</LI>\" & vbCrLf\n            Call ASPResponse.Write(objHTML.GetPage(p_strHTML))\n    End Select\n\nEnd Sub\n\n* * *\n\nWhat follows is the ASP code that calls the IIS Application:\n\n<%@ EnableSessionState=False Language=VBScript %>\n<%\n    Set obj = Server.CreateObject(\"Default.WebApp\")\n    \n    obj.Command()\n%>",
  "Tag": "kb745182366"
}