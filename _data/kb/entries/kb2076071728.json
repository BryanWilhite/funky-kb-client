{
  "Document": {
    "DocumentId": 2076071728,
    "Title": "T-SQL Code: Date Format User-Defined Function; dbo.fDateFormat()",
    "DocumentShortName": null,
    "FileName": null,
    "Path": null,
    "CreateDate": "2006-01-14T09:47:32.533",
    "ModificationDate": "2006-01-14T09:47:32.533",
    "TemplateId": null,
    "SegmentId": 72,
    "IsRoot": false,
    "IsActive": true,
    "SortOrdinal": null,
    "ClientId": null,
    "Tag": null
  },
  "Content": "IF OBJECT_ID('fDateFormat') IS NOT NULL \nBEGIN \n    DROP FUNCTION fDateFormat\n    IF OBJECT_ID('fDateFormat') IS NOT NULL\n        PRINT '<<< FAILED DROPPING FUNCTION fDateFormat >>>'\n    ELSE \n        PRINT '<<< DROPPED FUNCTION fDateFormat >>>'\nEND\n;\n/*\n    Based on dbo.FormatDateTime\n    at http://www.aspfaq.com/show.asp?id=2460.\n\n    \"You cannot use a non-deterministic function\n    within a UDF, e.g. GETDATE().\"\n    (http://www.aspfaq.com/show.asp?id=2439)\n*/\nCREATE FUNCTION dbo.fDateFormat\n    (\n        @cmdName varchar(16) = NULL\n    ,   @dt      datetime    = NULL\n    )\nRETURNS varchar(64)\nAS\nBEGIN\n    DECLARE @dtStr VARCHAR(64)\n\n    IF @cmdName = 'LONGDATE'\n    BEGIN\n        SET @dtStr = DATENAME(dw, @dt) \n        + ',' + SPACE(1) + DATENAME(m, @dt) \n        + SPACE(1) + CAST(DAY(@dt) AS VARCHAR(2)) \n        + ',' + SPACE(1) + CAST(YEAR(@dt) AS CHAR(4)) \n    END\n\n    IF @cmdName = 'LONGDATEANDTIME'\n    BEGIN\n        SET @dtStr = DATENAME(dw, @dt) \n        + ',' + SPACE(1) + DATENAME(m, @dt) \n        + SPACE(1) + CAST(DAY(@dt) AS VARCHAR(2)) \n        + ',' + SPACE(1) + CAST(YEAR(@dt) AS CHAR(4)) \n        + SPACE(1) + RIGHT(CONVERT(CHAR(20), \n        @dt - CONVERT(DATETIME, CONVERT(CHAR(8), \n        @dt, 112)), 22), 11)\n    END\n\n    IF @cmdName = 'SHORTDATE'\n    BEGIN \n        SET @dtStr = LEFT(CONVERT(CHAR(19), @dt, 0), 11)\n    END\n \n    IF @cmdName = 'SHORTDATEANDTIME'\n    BEGIN\n        SET @dtStr = REPLACE(REPLACE(CONVERT(CHAR(19), @dt, 0), \n            'AM', ' AM'), 'PM', ' PM') \n    END\n\n    IF @cmdName = 'UNIXTIMESTAMP'\n    BEGIN\n        SET @dtStr = CAST(DATEDIFF(SECOND, '19700101', @dt) AS VARCHAR(64)) \n    END\n\n    IF @cmdName = 'YYYYMMDD'\n    BEGIN\n        SET @dtStr = CONVERT(CHAR(8), @dt, 112) \n    END\n\n    IF @cmdName = 'YYYY-MM-DD'\n    BEGIN\n        SET @dtStr = CONVERT(CHAR(10), @dt, 23) \n    END\n\n    IF @cmdName = 'YYMMDD'\n    BEGIN\n        SET @dtStr = CONVERT(VARCHAR(8), @dt, 12) \n    END\n\n    IF @cmdName = 'YY-MM-DD'\n    BEGIN\n        SET @dtStr = STUFF(STUFF(CONVERT(VARCHAR(8), @dt, 12),5, 0, '-'), 3, 0, '-')\n    END\n\n    IF @cmdName = 'MMDDYY'\n    BEGIN\n        SET @dtStr = REPLACE(CONVERT(CHAR(8), @dt, 10), '-', SPACE(0)) \n    END\n\n    IF @cmdName = 'MM-DD-YY'\n    BEGIN\n        SET @dtStr = CONVERT(CHAR(8), @dt, 10) \n    END\n\n    IF @cmdName = 'MM/DD/YY' \n    BEGIN\n        SET @dtStr = CONVERT(CHAR(8), @dt, 1) \n    END\n\n    IF @cmdName = 'MM/DD/YYYY'\n    BEGIN\n        SET @dtStr = CONVERT(CHAR(10), @dt, 101) \n    END\n    IF @cmdName = 'DDMMYY'\n    BEGIN\n        SET @dtStr = REPLACE(CONVERT(CHAR(8), @dt, 3), '/', SPACE(0)) \n    END\n    IF @cmdName = 'DD-MM-YY'\n    BEGIN\n        SET @dtStr = REPLACE(CONVERT(CHAR(8), @dt, 3), '/', '-') \n    END\n\n    IF @cmdName = 'DD/MM/YY'\n    BEGIN\n        SET @dtStr = CONVERT(CHAR(8), @dt, 3) \n    END\n\n    IF @cmdName = 'DD/MM/YYYY'\n    BEGIN\n        SET @dtStr = CONVERT(CHAR(10), @dt, 103) \n    END\n\n    IF @cmdName = 'HH:MM:SS 24'\n    BEGIN\n        SET @dtStr = CONVERT(CHAR(8), @dt, 8) \n    END\n\n    IF @cmdName = 'HH:MM 24'\n    BEGIN\n        SET @dtStr = LEFT(CONVERT(VARCHAR(8), @dt, 8), 5) \n    END\n\n    IF @cmdName = 'HH:MM:SS 12'\n    BEGIN\n        SET @dtStr = LTRIM(RIGHT(CONVERT(VARCHAR(20), @dt, 22), 11)) \n    END\n\n    IF @cmdName = 'HH:MM 12'\n    BEGIN\n        SET @dtStr = LTRIM(SUBSTRING(CONVERT( \n        VARCHAR(20), @dt, 22), 10, 5) \n        + RIGHT(CONVERT(VARCHAR(20), @dt, 22), 3)) \n    END\n\n    IF @cmdName = 'RFC822'\n    BEGIN\n        IF LEN(DATENAME(dd,@dt)) > 1\n        BEGIN\n            SET @dtStr = SUBSTRING(DATENAME(dw,@dt),1,3)\n            + ', '\n            + DATENAME(dd,@dt)\n            + ' '\n            + SUBSTRING(DATENAME(m,@dt),1,3)\n            + ' '\n            + DATENAME(yy,@dt)\n            + ' '\n            + CONVERT(CHAR(8), @dt, 8)\n            + ' +0000'\n        END\n        ELSE\n        BEGIN\n            SET @dtStr = SUBSTRING(DATENAME(dw,@dt),1,3)\n            + ', 0'\n            + DATENAME(dd,@dt)\n            + ' '\n            + SUBSTRING(DATENAME(m,@dt),1,3)\n            + ' '\n            + DATENAME(yy,@dt)\n            + ' '\n            + CONVERT(CHAR(8), @dt, 8)\n            + ' +0000'\n        END\n\n    END\n\n    RETURN @dtStr\nEND\n;\nGRANT EXECUTE ON fDateFormat TO public\n;\nIF OBJECT_ID('fDateFormat') IS NOT NULL \n    PRINT '<<< CREATED FUNCTION fDateFormat >>>' \nELSE \n    PRINT '<<< FAILED CREATING FUNCTION fDateFormat >>>' \n;\n",
  "Tag": "kb2076071728"
}