{
  "Document": {
    "DocumentId": 2076071746,
    "Title": "C# Code: Loading A Bunch of Files",
    "DocumentShortName": null,
    "FileName": null,
    "Path": null,
    "CreateDate": "2006-06-02T21:46:42.967",
    "ModificationDate": "2006-06-02T21:46:42.967",
    "TemplateId": null,
    "SegmentId": 83,
    "IsRoot": false,
    "IsActive": true,
    "SortOrdinal": null,
    "ClientId": null,
    "Tag": null
  },
  "Content": "\n#region Unpack server log files and combine:\n\nstring root = Environment.ExpandEnvironmentVariables(@\"C:\\data\\raw_logs\");\nif (Directory.Exists(root))\n    this.WriteToLog(String.Format(\"Root found: {0} {1}\", root, Environment.NewLine));\nelse\n{\n    this.WriteToLog(String.Format(\"Root not found: {0} {1}\", root, Environment.NewLine));\n    return;\n}\n\nstring zipExe = Environment.ExpandEnvironmentVariables(@\"%ProgramFiles%\\7-Zip\\7z.exe\");\nstring zipExeArgs = @\"e -tother -o{0} {1}\";\nif (File.Exists(zipExe))\n    this.WriteToLog(String.Format(\"Archive utility found: {0} {1}\", zipExe, Environment.NewLine));\nelse\n{\n    this.WriteToLog(String.Format(\"Archive utility not found: {0} {1}\", zipExe, Environment.NewLine));\n    return;\n}\n\nstring archiveTmpFolder = Environment.ExpandEnvironmentVariables(@\"C:\\data\\raw_logs\\out\");\nif (Directory.Exists(archiveTmpFolder))\n    this.WriteToLog(String.Format(\"Archive temp folder found: {0} {1}\", archiveTmpFolder, Environment.NewLine));\nelse\n{\n    this.WriteToLog(String.Format(\"Archive temp folder not found: {0} {1}\", archiveTmpFolder, Environment.NewLine));\n    return;\n}\n\nforeach (string p in Directory.GetFiles(root))\n{\n    if (p.Contains(\".gz\"))\n    {\n        this.WriteToLog(String.Format(\"Extracting {0}…{1}\", p, Environment.NewLine));\n        ProcessStartInfo info = new ProcessStartInfo(zipExe);\n        info.Arguments = String.Format(zipExeArgs, archiveTmpFolder, p);\n        info.CreateNoWindow = true;\n        info.UseShellExecute = false;\n        Process.Start(info);\n    }\n    else if (p.Contains(\"access.log.\"))\n        File.Copy(p, String.Concat(archiveTmpFolder, String.Concat(archiveTmpFolder, @\"\\\", IO.FileName(p))));\n}\n\nstring combineCommand = String.Format(@\"copy {0}\\access* {1}\\log.txt\", archiveTmpFolder, root);\nthis.WriteToLog(String.Format(\"Copying and combining log file data…{0}\", Environment.NewLine));\nthis.WriteToLog(String.Format(\"{0}{1}\", Diagnostics.RunConsoleCommand(combineCommand), Environment.NewLine));\n\nthis.WriteToLog(String.Format(\"Clearing archive temp folder…{0}\", Environment.NewLine));\nthis.WriteToLog(String.Format(\"{0}{1}\", Diagnostics.RunConsoleCommand(String.Format(@\"del /q {0}\\access*\", archiveTmpFolder)), Environment.NewLine));\n\n#endregion\n\n",
  "Tag": "kb2076071746"
}