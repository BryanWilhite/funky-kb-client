<p>'This is a &quot;sketch&quot; of handling a DTS package programmatically.
'For more info' check out the following MSKB articles:
'
'&quot;Q221193 - INF: How To Install DTS Event Handlers In Visual Basic&quot;
'
'&quot;Q240221 - INF: How To Handle Errors in DTS Package and Step Objects&quot;
'
'&quot;Q252987 - INF: Execute a SQL Server DTS Package from Active Server Pages&quot;
'
'Any calls to routines beginning with &quot;bas&quot; have nothing to do with DTS
'and should be disregarded in this context.
'
'DTS variables.
Private WithEvents p_objDTSPack As DTS.Package
Private p_objTaskSQL As DTS.ExecuteSQLTask
Private p_objTaskPump As DTS.DataPumpTask
Private p_blnCancel As Boolean</p>
<p>Private Sub p_objDTSPack_OnError(ByVal EventSource As String, _
ByVal ErrorCode As Long, _
ByVal Source As String, _
ByVal Description As String, _
ByVal HelpFile As String, _
ByVal HelpContext As Long, _
ByVal IDofInterfaceWithError As String, _
ByRef p_blnCancel As Boolean)</p>
<pre><code>Call basAppInfoMsg(EventSource &amp; &amp;quot;: &amp;quot; &amp; Description, &amp;quot;DTS Error.&amp;quot;)
</code></pre>
<p>End Sub</p>
<p>Private Sub p_objDTSPack_OnFinish(ByVal EventSource As String)
Call basAppInfoMsg(&quot;DTS Package finished.&quot; _
&amp; vbNewLine &amp; &quot;(&quot; &amp; EventSource &amp; &quot;)&quot;)
End Sub</p>
<p>Private Sub p_objDTSPack_OnProgress(ByVal EventSource As String, _
ByVal ProgressDescription As String, _
ByVal PercentComplete As Long, _
ByVal ProgressCountLow As Long, _
ByVal ProgressCountHigh As Long)
' The DTS Package will trigger this event at certain intervals
' to report the progress of the package. This can be controlled
' by setting the DTS.Package.ProgressRowCount property.</p>
<pre><code>Call basAppInfoMsg(&amp;quot;DTS Package running&amp;#8230;&amp;quot; _
    &amp; vbNewLine &amp; &amp;quot;(&amp;quot; &amp; EventSource &amp; &amp;quot;: &amp;quot; _
    &amp; ProgressDescription &amp; &amp;quot;)&amp;quot;)
</code></pre>
<p>End Sub</p>
<p>Private Sub p_objDTSPack_OnQueryCancel(ByVal EventSource As String, _
ByRef p_blnCancel As Boolean)
' The DTS package will trigger this event at certain intervals to check
' whether the execution of the package should be terminated. Set
' p_blnCancel to true to cancel the execution of the package.
If p_blnCancel Then _
Call basAppInfoMsg(&quot;DTS Package query cancelled.&quot; _
&amp; vbNewLine &amp; &quot;(&quot; &amp; EventSource &amp; &quot;)&quot;)
End Sub</p>
<p>Private Sub p_objDTSPack_OnStart(ByVal EventSource As String)
Call basAppInfoMsg(&quot;DTS Package startingâ€¦&quot; _
&amp; vbNewLine &amp; &quot;(&quot; &amp; EventSource &amp; &quot;)&quot;)
End Sub</p>
<p>Public Function basHits() As Boolean</p>
<pre><code>'Import hits log file.

Call Me.basAppInfoMsg(&amp;quot;Running&amp;#8230;&amp;quot;, &amp;quot;Bulk inserting hit log file...&amp;quot;)

Set p_objDTSPack = VBA.CreateObject(&amp;quot;DTS.Package&amp;quot;)

With p_objDTSPack

    'The DTS package &amp;quot;ImportHitLog&amp;quot; was created in SQL server by hand.
    'Load package using NT security (dbDTSFlag_UseTrustedConnection = 256).
     Call .LoadFromSQLServer(ServerName:=dbSERVER, PackageName:=&amp;quot;ImportHitLog&amp;quot;, Flags:=dbDTSFlag_UseTrustedConnection)
    
    'Both of these Steps must run in the same thread for two reasons:
    'The Provider for the Bulk Insert Task does not support worker threads;
    'and the SQL Task must precede the Bulk Insert Task.
    .Steps(&amp;quot;DTSStep_DTSExecuteSQLTask_1&amp;quot;).ExecuteInMainThread = True
    .Steps(&amp;quot;DTSStep_DTSBulkInsertTask_1&amp;quot;).ExecuteInMainThread = True
    
    'Using the Execute method of the Package object
    'allows the Events (if any) to fire.
    .Execute

End With
</code></pre>
<p>End Function</p>
